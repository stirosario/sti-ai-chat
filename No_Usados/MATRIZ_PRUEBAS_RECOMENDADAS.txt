================================================================================
MATRIZ DE PRUEBAS RECOMENDADAS - ECOSISTEMA CHAT TECNOS
Fecha: 2025-01-XX
================================================================================

SET DE PRUEBAS MANUALES (15-30)
================================================================================

CATEGOR√çA 1: FLUJO CONVERSACIONAL B√ÅSICO
-------------------------------------------------------------------------------

PRUEBA 1: Flujo completo desde inicio hasta soluci√≥n
Objetivo: Verificar que el flujo completo funciona sin errores
Pasos:
1. Abrir chat
2. Aceptar GDPR y seleccionar idioma (Espa√±ol)
3. Ingresar nombre v√°lido
4. Seleccionar nivel de experiencia (B√°sico)
5. Seleccionar problema (No enciende)
6. Seleccionar dispositivo (PC)
7. Seguir pasos hasta resolver
8. Presionar "Ya lo solucion√©"
9. Dar feedback (üëç)
10. Verificar cierre correcto
Resultado esperado: Flujo completo sin errores, todos los stages transitados correctamente
Criterio de √©xito: Conversaci√≥n completa, feedback guardado, stage final = ENDED

PRUEBA 2: Flujo con nivel intermedio
Objetivo: Verificar adaptaci√≥n del flujo seg√∫n nivel de usuario
Pasos:
1. Iniciar conversaci√≥n
2. Seleccionar nivel "Intermedio"
3. Seguir flujo hasta pasos
4. Verificar que pasos sean apropiados para nivel intermedio
Resultado esperado: Pasos adaptados al nivel, no demasiado b√°sicos ni avanzados
Criterio de √©xito: Pasos coherentes con nivel seleccionado

PRUEBA 3: Flujo con nivel avanzado
Objetivo: Verificar que usuarios avanzados reciben pasos m√°s t√©cnicos
Pasos:
1. Iniciar conversaci√≥n
2. Seleccionar nivel "Avanzado"
3. Seguir flujo hasta pasos
4. Verificar que pasos sean m√°s t√©cnicos
Resultado esperado: Pasos m√°s avanzados, menos explicaciones b√°sicas
Criterio de √©xito: Pasos t√©cnicos apropiados para nivel avanzado

PRUEBA 4: Cambio de idioma (ES ‚Üí EN)
Objetivo: Verificar que cambio de idioma funciona correctamente
Pasos:
1. Iniciar conversaci√≥n en Espa√±ol
2. Completar hasta ASK_NEED
3. Verificar que mensajes est√©n en Espa√±ol
4. Reiniciar y seleccionar English
5. Verificar que mensajes est√©n en Ingl√©s
Resultado esperado: Todos los mensajes en el idioma seleccionado
Criterio de √©xito: i18n funcional, sin mezcla de idiomas

PRUEBA 5: Refresh de p√°gina durante conversaci√≥n
Objetivo: Verificar que sesi√≥n se mantiene despu√©s de refresh
Pasos:
1. Iniciar conversaci√≥n hasta ASK_USER_LEVEL
2. Refresh de p√°gina
3. Verificar que sesi√≥n se mantiene
4. Continuar conversaci√≥n
Resultado esperado: Sesi√≥n persistida, no se reinicia el flujo
Criterio de √©xito: userLevel y userName se mantienen, stage correcto

CATEGOR√çA 2: ASK_USER_LEVEL (NUEVO FLUJO)
-------------------------------------------------------------------------------

PRUEBA 6: ASK_USER_LEVEL aparece despu√©s de nombre
Objetivo: Verificar que paso de nivel aparece en el lugar correcto
Pasos:
1. Iniciar conversaci√≥n
2. Ingresar nombre
3. Verificar que aparece pregunta de nivel
4. Seleccionar nivel
5. Verificar que aparece pregunta de problema
Resultado esperado: Orden correcto: ASK_NAME ‚Üí ASK_USER_LEVEL ‚Üí ASK_NEED
Criterio de √©xito: Transiciones correctas, no se salta ASK_USER_LEVEL

PRUEBA 7: ASK_USER_LEVEL se salta si ya existe userLevel
Objetivo: Verificar que no se repite pregunta de nivel
Pasos:
1. Iniciar conversaci√≥n
2. Completar hasta tener userLevel
3. Refresh de p√°gina
4. Continuar conversaci√≥n
5. Verificar que NO aparece pregunta de nivel
Resultado esperado: Se salta ASK_USER_LEVEL, va directo a ASK_NEED
Criterio de √©xito: L√≥gica de skip funciona (l√≠nea ~3934 server.js)

PRUEBA 8: Texto libre en ASK_USER_LEVEL
Objetivo: Verificar que texto libre mapea correctamente a niveles
Pasos:
1. Llegar a ASK_USER_LEVEL
2. Escribir "b√°sico" (sin presionar bot√≥n)
3. Verificar que se acepta
4. Repetir con "intermedio" y "avanzado"
Resultado esperado: Texto libre mapea a niveles correctamente
Criterio de √©xito: Regex funciona (/b√°sico|basic/i, etc.)

PRUEBA 9: Texto inv√°lido en ASK_USER_LEVEL
Objetivo: Verificar manejo de texto no reconocido
Pasos:
1. Llegar a ASK_USER_LEVEL
2. Escribir "no s√©" o texto no relacionado
3. Verificar que se pide elegir opci√≥n
4. Verificar que se re-muestran botones
Resultado esperado: Mensaje aclaratorio, botones re-muestran
Criterio de √©xito: No se rompe el flujo, se gu√≠a al usuario

CATEGOR√çA 3: FEEDBACK BINARIO
-------------------------------------------------------------------------------

PRUEBA 10: Feedback despu√©s de BTN_SOLVED
Objetivo: Verificar que feedback aparece despu√©s de resolver
Pasos:
1. Completar conversaci√≥n hasta resolver problema
2. Presionar "Ya lo solucion√©"
3. Verificar que aparecen botones üëç/üëé
4. Presionar üëç
5. Verificar cierre correcto
Resultado esperado: Feedback aparece, se guarda, cierra correctamente
Criterio de √©xito: feedbackRecorded = true, stage = ENDED

PRUEBA 11: Feedback antes de cerrar (BTN_CLOSE)
Objetivo: Verificar que feedback aparece antes de cerrar
Pasos:
1. Iniciar conversaci√≥n
2. Presionar "Cerrar Chat" sin haber resuelto
3. Verificar que aparecen botones üëç/üëé
4. Presionar üëé
5. Verificar cierre correcto
Resultado esperado: Feedback aparece antes de cerrar, se guarda
Criterio de √©xito: feedbackRecorded = true, stage = ENDED

PRUEBA 12: Feedback no se duplica
Objetivo: Verificar que feedback no aparece dos veces
Pasos:
1. Completar hasta BTN_SOLVED
2. Dar feedback (üëç)
3. Verificar que NO aparece feedback de nuevo
4. Intentar cerrar
5. Verificar que cierra directamente sin feedback
Resultado esperado: feedbackRecorded previene duplicaci√≥n
Criterio de √©xito: feedbackButtonsShown = false despu√©s de votar

PRUEBA 13: Texto libre despu√©s de mostrar feedback (CASO 6B)
Objetivo: Verificar que texto libre re-muestra feedback
Pasos:
1. Completar hasta BTN_SOLVED
2. Ver feedback (üëç/üëé)
3. Escribir texto libre (ej: "gracias")
4. Verificar que se pide elegir feedback
5. Verificar que se re-muestran botones
Resultado esperado: Mensaje espec√≠fico, botones re-muestran
Criterio de √©xito: CASO 6B funciona (l√≠nea ~8073 server.js)

CATEGOR√çA 4: BOTONES Y TOKENS
-------------------------------------------------------------------------------

PRUEBA 14: Botones muestran texto, no tokens
Objetivo: Verificar que usuario nunca ve tokens internos
Pasos:
1. Completar conversaci√≥n
2. Revisar todos los botones mostrados
3. Verificar que muestran texto descriptivo
4. Verificar que NO muestran "BTN_..." o tokens
Resultado esperado: Todos los botones muestran labels, nunca tokens
Criterio de √©xito: normalizeButtons() funciona correctamente

PRUEBA 15: Usuario escribe token manualmente
Objetivo: Verificar comportamiento cuando usuario escribe token
Pasos:
1. Llegar a etapa con botones
2. Escribir "BTN_SOLVED" manualmente
3. Verificar que backend lo procesa
4. Verificar que frontend muestra label, no token
Resultado esperado: Backend procesa, frontend muestra label
Criterio de √©xito: Mapeo funciona, no se muestra token crudo

PRUEBA 16: Variantes de texto libre
Objetivo: Verificar que variantes de texto se mapean correctamente
Pasos:
1. Llegar a ASK_USER_LEVEL
2. Probar: "b√°sico", "BASICO", "Basico", "basico"
3. Verificar que todos funcionan
4. Repetir con otros niveles
Resultado esperado: Variantes funcionan (case-insensitive)
Criterio de √©xito: Regex case-insensitive funciona

CATEGOR√çA 5: DETECCI√ìN DE DISPOSITIVO Y OS
-------------------------------------------------------------------------------

PRUEBA 17: Pasos sin OS cuando se requiere
Objetivo: Verificar que faltanDatosMinimos() previene pasos sin OS
Pasos:
1. Iniciar conversaci√≥n
2. Llegar a BASIC_TESTS sin especificar OS
3. Verificar que se pregunta OS antes de mostrar pasos
4. Especificar OS
5. Verificar que ahora se muestran pasos
Resultado esperado: faltanDatosMinimos() previene pasos sin datos
Criterio de √©xito: Se pregunta OS antes de pasos espec√≠ficos de OS

PRUEBA 18: Pasos sin tipo de perif√©rico
Objetivo: Verificar validaci√≥n para perif√©ricos
Pasos:
1. Seleccionar problema de perif√©rico
2. Llegar a BASIC_TESTS sin especificar tipo
3. Verificar que se pregunta tipo de perif√©rico
4. Especificar tipo
5. Verificar que se muestran pasos
Resultado esperado: Validaci√≥n funciona para perif√©ricos
Criterio de √©xito: faltanDatosMinimos() detecta falta de tipo

PRUEBA 19: Pasos con OS especificado
Objetivo: Verificar que pasos son espec√≠ficos del OS
Pasos:
1. Especificar Windows como OS
2. Llegar a BASIC_TESTS
3. Verificar que pasos son espec√≠ficos de Windows
4. Repetir con macOS y Linux
Resultado esperado: Pasos adaptados al OS especificado
Criterio de √©xito: Pasos coherentes con OS

CATEGOR√çA 6: SIMULACIONES Y GUARD RAILS
-------------------------------------------------------------------------------

PRUEBA 20: Simulaci√≥n no crea tickets reales
Objetivo: Verificar guard rail de simulaciones
Pasos:
1. Ejecutar simulaci√≥n desde admin.php
2. Forzar escalaci√≥n a t√©cnico
3. Verificar logs: [SIMULATION_GUARD] bloqueado
4. Verificar que NO se crea ticket real
Resultado esperado: Guard rail activo, no tickets reales
Criterio de √©xito: createTicketAndRespond verifica session.simulation

PRUEBA 21: Simulaci√≥n no env√≠a WhatsApp
Objetivo: Verificar aislamiento de WhatsApp
Pasos:
1. Ejecutar simulaci√≥n
2. Forzar ofrecimiento de WhatsApp
3. Verificar logs: [SIMULATION_GUARD]
4. Verificar que NO se env√≠a WhatsApp real
Resultado esperado: Guard rail activo, no WhatsApp real
Criterio de √©xito: Guard rails verifican session.simulation

PRUEBA 22: Simulaci√≥n no guarda feedback real
Objetivo: Verificar guard rail de feedback
Pasos:
1. Ejecutar simulaci√≥n hasta feedback
2. Dar feedback (üëç)
3. Verificar logs: [FEEDBACK] [SIMULATION_GUARD] bloqueado
4. Verificar que NO se guarda archivo de feedback
Resultado esperado: Guard rail activo, no feedback real
Criterio de √©xito: saveFeedback() verifica session.simulation (l√≠nea ~1127)

CATEGOR√çA 7: RATE LIMITS Y SEGURIDAD
-------------------------------------------------------------------------------

PRUEBA 23: Rate limit en /api/chat
Objetivo: Verificar que rate limit funciona
Pasos:
1. Enviar 50+ requests a /api/chat en 5 minutos
2. Verificar que se activa rate limit
3. Verificar logs: [RATE_LIMIT] endpoint=/api/chat
4. Verificar respuesta HTTP 429
Resultado esperado: Rate limit activo despu√©s de 50 requests
Criterio de √©xito: chatRateLimiter funciona (l√≠nea ~521 server.js)

PRUEBA 24: Rate limit en /api/simulations/run
Objetivo: Verificar rate limit de simulaciones
Pasos:
1. Ejecutar 10+ simulaciones en 1 hora
2. Verificar que se activa rate limit
3. Verificar logs: [RATE_LIMIT] endpoint=/api/simulations/run
Resultado esperado: Rate limit activo despu√©s de 10 simulaciones
Criterio de √©xito: simulationsRateLimiter funciona (l√≠nea ~542)

PRUEBA 25: Autenticaci√≥n en /api/simulations/run
Objetivo: Verificar que requiere ADMIN_TOKEN
Pasos:
1. Intentar ejecutar simulaci√≥n sin ADMIN_TOKEN
2. Verificar respuesta HTTP 403
3. Verificar logs: [SECURITY] Request sin autenticaci√≥n bloqueado
4. Ejecutar con ADMIN_TOKEN v√°lido
5. Verificar que funciona
Resultado esperado: Autenticaci√≥n obligatoria
Criterio de √©xito: Verificaci√≥n de ADMIN_TOKEN funciona (l√≠nea ~11281)

CATEGOR√çA 8: ERRORES Y EDGE CASES
-------------------------------------------------------------------------------

PRUEBA 26: Timeout de OpenAI
Objetivo: Verificar fallback cuando OpenAI timeout
Pasos:
1. Forzar timeout de OpenAI (mock o delay)
2. Verificar que se retorna respuesta gen√©rica
3. Verificar logs: [OPENAI] Timeout
4. Verificar que usuario recibe mensaje, no error
Resultado esperado: Fallback funciona, usuario no ve error
Criterio de √©xito: Manejo de timeout funciona (l√≠nea ~6980)

PRUEBA 27: Texto muy largo
Objetivo: Verificar validaci√≥n de tama√±o
Pasos:
1. Enviar texto > 5000 caracteres
2. Verificar respuesta HTTP 400
3. Verificar mensaje de error claro
4. Verificar que se indica l√≠mite m√°ximo
Resultado esperado: Validaci√≥n funciona, mensaje claro
Criterio de √©xito: validateUserText() funciona (l√≠nea ~10664)

PRUEBA 28: Sesi√≥n expirada (TTL)
Objetivo: Verificar que sesi√≥n expira despu√©s de 30 minutos
Pasos:
1. Iniciar conversaci√≥n
2. Esperar 30+ minutos sin actividad
3. Intentar continuar conversaci√≥n
4. Verificar que sesi√≥n se reinicia o maneja correctamente
Resultado esperado: TTL funciona, sesi√≥n expirada se maneja
Criterio de √©xito: USER_SESSION_TIMEOUT_MS funciona (30 minutos)

SET DE PRUEBAS POR SIMULACI√ìN (PERFILES/IDIOMAS)
================================================================================

PERFIL 1: Usuario Novato - Espa√±ol
-------------------------------------------------------------------------------
Configuraci√≥n:
- locale: 'es-AR'
- userType: 'novato'
- device: null (aleatorio)
- problem: null (aleatorio)
- os: null (aleatorio)
- realisticMode: true
- maxSteps: 50

Casos a probar:
1. Flujo completo hasta soluci√≥n
2. Flujo hasta escalaci√≥n
3. Flujo con errores ortogr√°ficos
4. Flujo con repeticiones (realisticMode)

Resultado esperado:
- userLevel generado: 'basic' (100%)
- Pasos apropiados para nivel b√°sico
- Respuestas en Espa√±ol
- Errores detectados si hay problemas

PERFIL 2: Usuario Intermedio - Ingl√©s
-------------------------------------------------------------------------------
Configuraci√≥n:
- locale: 'en-US'
- userType: 'medio'
- device: 'notebook'
- problem: 'not turning on'
- os: 'Windows'
- realisticMode: true
- maxSteps: 50

Casos a probar:
1. Flujo completo hasta soluci√≥n
2. Flujo hasta escalaci√≥n
3. Flujo con variantes de texto
4. Flujo con typos

Resultado esperado:
- userLevel generado: 'intermediate' (70%), 'basic' o 'advanced' (30%)
- Pasos apropiados para nivel intermedio
- Respuestas en Ingl√©s
- Errores detectados si hay problemas

PERFIL 3: Usuario T√©cnico - Espa√±ol
-------------------------------------------------------------------------------
Configuraci√≥n:
- locale: 'es-AR'
- userType: 'tecnico'
- device: 'pc'
- problem: 'muy lenta'
- os: 'Linux'
- realisticMode: false (strictMode)
- maxSteps: 50

Casos a probar:
1. Flujo completo hasta soluci√≥n
2. Flujo hasta pruebas avanzadas
3. Flujo sin errores (strictMode)
4. Flujo con pasos t√©cnicos

Resultado esperado:
- userLevel generado: 'advanced' (100%)
- Pasos t√©cnicos apropiados
- Respuestas en Espa√±ol
- Menos errores (strictMode)

PERFIL 4: M√∫ltiples simulaciones simult√°neas
-------------------------------------------------------------------------------
Configuraci√≥n:
- Ejecutar 5 simulaciones en paralelo
- Diferentes perfiles (novato, medio, tecnico)
- Diferentes idiomas (es-AR, en-US)
- realisticMode: true

Casos a probar:
1. Ejecutar 5 simulaciones simult√°neas
2. Verificar que no hay interferencia
3. Verificar que guard rails funcionan
4. Verificar que logs se generan correctamente

Resultado esperado:
- Simulaciones independientes
- Guard rails activos en todas
- Logs separados por simulationId
- Sin errores de concurrencia

ESCENARIOS DE REGRESI√ìN CR√çTICOS
================================================================================

REGRESI√ìN 1: Feedback despu√©s de BTN_SOLVED
-------------------------------------------------------------------------------
Objetivo: Verificar que feedback aparece y no se duplica
Pasos:
1. Completar conversaci√≥n hasta BTN_SOLVED
2. Verificar que aparecen botones üëç/üëé
3. Presionar üëç
4. Verificar que se guarda feedback
5. Verificar que NO aparece feedback de nuevo
6. Verificar que stage = ENDED
Resultado esperado: Feedback funciona, no se duplica, cierra correctamente
Archivos afectados: server.js l√≠nea ~7600+ (CASO 3A), ~7706+ (CASO 3B)
Riesgo: ALTO - Si falla, usuario no puede cerrar conversaci√≥n

REGRESI√ìN 2: Feedback antes de BTN_CLOSE
-------------------------------------------------------------------------------
Objetivo: Verificar que feedback aparece antes de cerrar
Pasos:
1. Iniciar conversaci√≥n
2. Presionar "Cerrar Chat" sin resolver
3. Verificar que aparecen botones üëç/üëé
4. Presionar üëé
5. Verificar que se guarda feedback
6. Verificar que cierra correctamente
Resultado esperado: Feedback aparece antes de cerrar, se guarda, cierra
Archivos afectados: server.js l√≠nea ~7060+ (CASO 6A)
Riesgo: ALTO - Si falla, usuario no puede dar feedback al cerrar

REGRESI√ìN 3: ASK_USER_LEVEL no se salta cuando deber√≠a
-------------------------------------------------------------------------------
Objetivo: Verificar que ASK_USER_LEVEL se salta si userLevel existe
Pasos:
1. Completar conversaci√≥n hasta tener userLevel
2. Refresh de p√°gina
3. Continuar conversaci√≥n
4. Verificar que NO aparece pregunta de nivel
5. Verificar que va directo a ASK_NEED
Resultado esperado: Se salta ASK_USER_LEVEL, no se repite
Archivos afectados: server.js l√≠nea ~3934+ (CASO 0)
Riesgo: MEDIO - Si falla, usuario ve pregunta repetida

REGRESI√ìN 4: Guard rail de simulaci√≥n no funciona
-------------------------------------------------------------------------------
Objetivo: Verificar que simulaciones no afectan producci√≥n
Pasos:
1. Ejecutar simulaci√≥n
2. Forzar creaci√≥n de ticket
3. Verificar logs: [SIMULATION_GUARD] bloqueado
4. Verificar que NO se crea ticket real
5. Verificar que NO se env√≠a WhatsApp
6. Verificar que NO se guarda feedback real
Resultado esperado: Guard rails activos, producci√≥n no afectada
Archivos afectados: server.js m√∫ltiples lugares (createTicketAndRespond, saveFeedback, etc.)
Riesgo: CR√çTICO - Si falla, simulaciones afectan producci√≥n

REGRESI√ìN 5: faltanDatosMinimos() no se verifica
-------------------------------------------------------------------------------
Objetivo: Verificar que se valida antes de mostrar pasos
Pasos:
1. Iniciar conversaci√≥n
2. Llegar a BASIC_TESTS sin especificar OS
3. Verificar que se pregunta OS antes de mostrar pasos
4. Especificar OS
5. Verificar que ahora se muestran pasos
Resultado esperado: Validaci√≥n funciona, no se muestran pasos sin datos
Archivos afectados: server.js l√≠nea ~4950+ (funci√≥n), ~6110+ (uso)
Riesgo: MEDIO - Si falla, usuario recibe pasos inaplicables

REGRESI√ìN 6: Tokens internos aparecen en frontend
-------------------------------------------------------------------------------
Objetivo: Verificar que usuario nunca ve tokens
Pasos:
1. Completar conversaci√≥n
2. Revisar todos los botones mostrados
3. Verificar que muestran texto, no tokens
4. Escribir token manualmente (ej: "BTN_SOLVED")
5. Verificar que frontend muestra label, no token
Resultado esperado: Usuario nunca ve tokens, siempre labels
Archivos afectados: index.php l√≠nea ~1707+ (normalizeButtons)
Riesgo: MEDIO - Si falla, usuario ve c√≥digos t√©cnicos

REGRESI√ìN 7: Rate limit no funciona
-------------------------------------------------------------------------------
Objetivo: Verificar que rate limits previenen abuso
Pasos:
1. Enviar 50+ requests a /api/chat en 5 minutos
2. Verificar que se activa rate limit
3. Verificar logs: [RATE_LIMIT]
4. Verificar respuesta HTTP 429
Resultado esperado: Rate limit activo, previene abuso
Archivos afectados: server.js l√≠nea ~521+ (chatRateLimiter)
Riesgo: ALTO - Si falla, servidor vulnerable a DoS

REGRESI√ìN 8: Timeout de OpenAI sin fallback
-------------------------------------------------------------------------------
Objetivo: Verificar que timeout tiene fallback
Pasos:
1. Forzar timeout de OpenAI
2. Verificar que se retorna respuesta gen√©rica
3. Verificar que usuario no ve error
4. Verificar logs: [OPENAI] Timeout
Resultado esperado: Fallback funciona, usuario no ve error
Archivos afectados: server.js l√≠nea ~6980+ (manejo de timeout)
Riesgo: MEDIO - Si falla, usuario ve error t√©cnico

================================================================================
FIN DE LA MATRIZ
================================================================================

